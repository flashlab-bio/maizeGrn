function arr_swap(a,b,c){var d=a[b];a[b]=a[c],a[c]=d;}function inputcheck(c){var b=1;var a=c.val().trim().split(/[\s,]+/g);return a[0]?a.some(function(a,b,c){return c.indexOf(a,b+1)!==-1;})?alert(str2):cPanel=='b'&&$('#p_b input[type=checkbox]:checked').length==0?alert(str3):cPanel=='b'&&a.length>ql?alert(str4.sprintf(ql)):cPanel=='d'&&a.length>cl?alert(str4.sprintf(cl)):b=0:alert(str1),b;}function genlink(d,c,b,e){if(!1&&window.navigator.msSaveBlob){var a=new Blob([decodeURIComponent(c)],{type:'text/tsv;charset=utf8'});window.navigator.msSaveBlob(a,b);}else if(window.Blob&&window.URL){var a=new Blob([c],{type:'text/'+e+';charset=utf8'});var f=URL.createObjectURL(a);d.attr({download:b,href:f});}else{alert(b);var g='data:application/'+e+';charset=utf-8,'+encodeURIComponent(c);d.attr({download:b,href:g,target:'_blank'});}}intersect=function(){return Array.from(arguments).reduce(function(a,b){return a.filter(function(a){return b.includes(a);});});},console.log=function(b){var a=new Date();$('#msg').html('<a>'+a.getMinutes()+':'+a.getSeconds()+'</a>'+b+'<br />'+$('#msg').html());},String.prototype.sprintf||(String.prototype.sprintf=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(c,b){return a[b]!==void 0?a[b]:c;});}),$(document).ready(function(){$('form').submit(function(b){if(cPanel=$('#p_b').is(':visible')?'b':'d',inputcheck($('#p_'+cPanel+' textarea')))return!1;var a=$(this).serialize();$('form input,form button').prop('disabled',!0),$.ajax({type:'POST',url:'api.php',data:a,dataType:'json',success:function(c){if(cPanel=='d'){var b=[str5,str6,''];$('input[name="s_v4"]:checked').val()==1&&arr_swap(b,0,1);var a='<h2>'+str11+'</h2><a id="dlc"><button class="hl fa">'+str7+'</button></a><table id="fullcon">';var e='';$.each(c,function(c,b){c==0?a+='<thead><tr><th>'+b.replace(/\t/g,'</th><th>')+'</th></tr></thead><tbody>':(e='',$.each(b,function(b,a){e+='<td>'+a+'</td>';}),a+='<tr>'+e+'</tr>');}),a=a+'</tbody></table><i>'+(e?str8:str21)+'</i>',$('#idres').html(a),$('#idres td').on('mouseenter',function(){var a=$(this);this.offsetWidth<this.scrollWidth&&!a.attr('title')&&a.attr('title',a.text()),b[a.index()]&&a.attr('style','cursor:alias');}).on('dblclick',function(){var a=$(this).index();b[a]&&$(this).text()!='null'&&window.open(b[a].sprintf($(this).text()));}),$('#dlc').on('click',function(){var a='';$('#fullcon tr').each(function(){a+=$.map($(this).children(),function(a){return $(a).text();}).join('\t')+'\n';}),genlink($(this),a,'id_convert.tsv','tsv');});}else if($('input[name="s_flag"]:checked').val()==1){var b=[str9,str5,'','','','','',str10,'','',''];$('input[name="s_tar"]:checked').val()==1&&arr_swap(b,0,1);var g='';var a='<h2>'+str12+'</h2> <b>'+str17.sprintf('{ <span id="orgs"></span>}')+'</b><br /><code>'+str18+'</code><a id="dlf"><button class="hl fa">'+str19.sprintf($('input[name="s_num"]').val())+'</button></a><div id="fullscm"><table><thead><tr>';$.each(c,function(b,c){b=='head'?($.each(c,function(c,b){a+='<th>'+b+'</th>';}),a+='</tr></thead><tbody>'):(a+='<tr id="'+b+'" style="border-left:7px solid red;"><th colspan="11">'+b+'('+c.length+')</th></tr>',g+='<a href="#'+b+'"><button class="sm"'+(c.length?'>':' disabled>')+b+'</button></a> ',$.each(c,function(d,c){var b='';$.each(c,function(c,a){b+='<td>'+a+'</td>';}),a+='<tr>'+b+'</tr>';}));}),a+='</tbody></table></div><div class="b2t"><a href="#fullscm"><span></span>%</a></div>',$('#results').html(a),$('#orgs').html(g),$('#results td').on('mouseenter',function(){var a=$(this);this.offsetWidth<this.scrollWidth&&!a.attr('title')&&a.attr('title',a.text()),b[a.index()]&&a.attr('style','cursor:alias');}).on('dblclick',function(){var a=$(this).index();b[a]&&$(this).text()!='null'&&window.open(b[a].sprintf($(this).text()));}),$('#dlf').on('click',function(){var a='';$('#fullscm>table tr').each(function(){a+=$.map($(this).children(),function(a){return $(a).text();}).join('\t')+'\n';}),genlink($(this),a,'summary.tsv','tsv');}),$(window).on('scroll',function(){if(!$('#fullscm').is(':visible'))return;var b=$(window).scrollTop();var c=$('#fullscm').offset().top;var d=$('#fullscm').height();var e=$(window).height();var f=(b-c)/(d-e);var a=Math.round(f*100);$('.b2t').toggleClass('b2t-on',a>1&&a<101),$('.b2t span').html(a);});}else if($('input[name="s_flag"]:checked').val()==3)$('#results').html(parseInt(c[0])?'<h2>'+str13+'</h2><a href="'+c[1]+'"><button class="hl fa">'+str20.sprintf(c[0])+'</button></a>':str21);else if($('input[name="s_flag"]:checked').val()==0){var f=$('#p_'+cPanel+' textarea').val().trim().toUpperCase().split(/[\s,]+/g);var d=$('#p_b input[type=checkbox]:checked').map(function(){return $(this).prop('name');}).get();var h;var a='<div><h2>'+str14.sprintf($('input[name="s_tar"]').is(':checked')?str15:str16)+'</h2></div>';a+='<a id="dlt"><button class="hl fa">'+str22+'</button></a><div id="genebox"><div class="bg"></div><textarea id="editbox"></textarea><button class="sm" onclick="$(this).parent().hide()">close</button></div><table id="stbl"><thead><tr><th></th><th>'+d.join('</th><th>')+'</th></tr></thead><tbody>',$.each(f,function(f,e){var b='';$.each(d,function(d,a){e in c[a]?(h=String(c[a][e]).split(','),b+='<td data-id="'+h.join()+'">'+h.length+'</td>'):b+='<td>0</td>';}),a+='<tr><th>'+e+'</th>'+b+'</tr>';}),a+='</tbody></table><code>'+str23+'</code><div id="venn"><span id="cid"></span></div>',$('#results').html(a),$('#dlt').on('click',function(){var a='#'+f.toString()+';'+d.toString();$('#stbl td').each(function(b,c){$(this).is('[data-id]')&&(a+=(','+$(this).attr('data-id')).replace(/,/g,'\n'+f[b/d.length|0]+'\t'+d[b%d.length]+'\t'));}),genlink($(this),a,'grn_table.sif','tsv');}),$('#stbl').on('dblclick','td',function(a){$('#editbox').val($(this).attr('data-id')),$('#genebox').show();}),$('#stbl').on('dblclick','th',function(j){var h=$(this).index();var a=[];var c=[];var b=[];var d=0;h?$('#stbl tr td:nth-child('+(h+1)+')').each(function(){$(this).is('[data-id]')&&(c[d]=$(this).text(),a[d]=$(this).siblings('th').text(),b[d]=$(this).data('id'),d++);}):$(this).parent().children('td').each(function(){$(this).is('[data-id]')&&(c[d]=$(this).text(),a[d]=$('#stbl thead tr th').eq($(this).index()).text(),b[d]=$(this).data('id'),d++);});switch(d){case 2:x0=intersect(b[0].split(','),b[1].split(','));f=[{sets:[a[0]],size:c[0]},{sets:[a[1]],size:c[1]},{sets:[a[0],a[1]],size:x0.length,arr:'x0'}];break;case 3:x1=intersect(b[0].split(','),b[1].split(','));x2=intersect(b[0].split(','),b[2].split(','));x3=intersect(b[1].split(','),b[2].split(','));x4=intersect(x1,b[2].split(','));var f=[{sets:[a[0]],size:c[0]},{sets:[a[1]],size:c[1]},{sets:[a[2]],size:c[2]},{sets:[a[0],a[1]],size:x1.length,arr:'x1'},{sets:[a[0],a[2]],size:x2.length,arr:'x2'},{sets:[a[1],a[2]],size:x3.length,arr:'x3'},{sets:[a[0],a[1],a[2]],size:x4.length,arr:'x4'}];break;case 4:x1=intersect(b[0].split(','),b[1].split(','));x2=intersect(b[0].split(','),b[2].split(','));x3=intersect(b[0].split(','),b[3].split(','));x4=intersect(b[1].split(','),b[2].split(','));x5=intersect(b[1].split(','),b[3].split(','));x6=intersect(b[2].split(','),b[3].split(','));x7=intersect(x1,x6);var f=[{sets:[a[0]],size:c[0]},{sets:[a[1]],size:c[1]},{sets:[a[2]],size:c[2]},{sets:[a[3]],size:c[3]},{sets:[a[0],a[1]],size:x1.length,arr:'x1'},{sets:[a[0],a[2]],size:x2.length,arr:'x2'},{sets:[a[0],a[3]],size:x3.length,arr:'x3'},{sets:[a[1],a[2]],size:x4.length,arr:'x4'},{sets:[a[1],a[3]],size:x5.length,arr:'x5'},{sets:[a[2],a[3]],size:x6.length,arr:'x6'},{sets:[a[0],a[1],a[2],a[3]],size:x7.length,arr:'x7'}];break;default:return;}var i=venn.VennDiagram();var e=d3.select('#venn');e.datum(f).call(i);var g=d3.select('body').append('div').attr('class','venntooltip');e.selectAll('path').style('stroke-opacity',0).style('stroke','#fff').style('stroke-width',3),e.selectAll('g').on('mouseover',function(a,c){venn.sortAreas(e,a),g.transition().duration(400).style('opacity',0.9),g.text(a.size+' genes');var b=d3.select(this).transition('tooltip').duration(400);b.select('path').style('stroke-width',3).style('fill-opacity',a.sets.length==1?0.4:0.1).style('stroke-opacity',1);}).on('mousemove',function(){g.style('left',d3.event.pageX+'px').style('top',d3.event.pageY-28+'px');}).on('mouseout',function(b,c){g.transition().duration(400).style('opacity',0);var a=d3.select(this).transition('tooltip').duration(400);a.select('path').style('stroke-width',0).style('fill-opacity',b.sets.length==1?0.25:0).style('stroke-opacity',0);}).on('dblclick',function(a,b){a.arr!==void 0&&($('#editbox').val(window[a.arr].toString()),$('#genebox').show());}),$('#cid').html('Chart for <q>'+$(this).text()+'</q> <code>'+str24+'</code>');});}},complete:function(a,b){$('form input,form button').prop('disabled',!1);}}),b.preventDefault();});});